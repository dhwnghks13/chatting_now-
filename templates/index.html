<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ’¬ ì±„íŒ…ë°©</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        body { padding: 20px; font-family: sans-serif; background: #f0f2f5; }
        #chatBox { height: 500px; background: white; border-radius: 15px; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; border: 1px solid #ddd; }
        .input-container { display: flex; gap: 10px; margin-top: 20px; }
        #nickname, #name { width: 15%; padding: 10px; border-radius: 8px; border: 1px solid #ddd; }
        #chatInput { flex-grow: 1; padding: 10px; border-radius: 8px; border: 1px solid #ddd; }
        button { padding: 10px 20px; background: #2196f3; color: white; border: none; border-radius: 8px; cursor: pointer; }
        .msg-box { display: flex; flex-direction: column; max-width: 80%; }
        .normal { align-self: flex-start; }
        .admin { align-self: flex-end; align-items: flex-end; }
        .message { padding: 10px; border-radius: 10px; background: #e9efff; }
        .admin .message { background: #e3f2fd; border: 2px solid #2196f3; }
        .nickname { font-size: 12px; font-weight: bold; margin-bottom: 4px; }
        .system { text-align: center; color: #888; font-size: 12px; }
        .link-card { display: flex; border: 1px solid #ddd; border-radius: 8px; overflow: hidden; margin-top: 5px; background: white; text-decoration: none; color: black; }
        .link-card img { width: 80px; height: 80px; object-fit: cover; }
        .link-info { padding: 10px; font-size: 12px; }
    </style>
</head>
<body>
    <div id="userStatus">ì ‘ì† ì¤‘...</div>
    <div id="chatBox"></div>
    <div class="input-container">
        <input type="text" id="nickname" placeholder="ë‹‰ë„¤ì„">
        <input type="text" id="name" placeholder="ì‹¤ëª…">
        <input type="text" id="chatInput" placeholder="ë©”ì‹œì§€ ì…ë ¥" onkeypress="if(event.keyCode==13)sendMyMessage()">
        <button onclick="sendMyMessage()">ì „ì†¡</button>
    </div>

    <script>
        var socket = io();

        function sendMyMessage() {
            var nick = document.getElementById('nickname').value;
            var real = document.getElementById('name').value;
            var msg = document.getElementById('chatInput').value;
            if(!nick || !real || !msg) return alert("ë¹ˆì¹¸ì„ ì±„ì›Œì£¼ì„¸ìš”!");
            
            socket.emit('my_chat', { name: nick, ylm: real, msg: msg });
            document.getElementById('chatInput').value = "";
        }

        socket.on('my_chat', function(data) {
            console.log("ë°›ì€ ë°ì´í„°:", data); // ë¸Œë¼ìš°ì € F12 ì½˜ì†”ì—ì„œ ë°ì´í„° í™•ì¸ìš©
        
            var chatBox = document.getElementById('chatBox');
            if (!chatBox) return; // ì±„íŒ…ì°½ ì—†ìœ¼ë©´ ì¤‘ë‹¨

            var displayName = data.name || "ìµëª…";
    
            // â­ [ì²´í¬!] ì‹¤ëª… í‘œì‹œ ë¶€ë¶„ - ì´ë¦„ì´ ë‹¤ë¥´ë©´ ì•ˆ ë‚˜ì˜´
            // ì„œë²„ì—ì„œ 'real_name_secret'ìœ¼ë¡œ ë³´ëƒˆëŠ”ì§€ í™•ì¸í•´!
            if (data.real_name_secret) {
                displayName += ` <span style="color: #ff5722; font-size: 11px;">(${data.real_name_secret})</span>`;
            }
    
            var html = "";
            if (data.role === 'system') {
                html = `<div class="system"><span>${data.msg}</span></div>`;
            } else {
                var boxClass = (data.role === 'admin') ? 'admin' : 'normal';
                var msgContent = data.msg || "";
        
                // ë¯¸ë””ì–´(ìœ íŠœë¸Œ, ì´ë¯¸ì§€ ë“±) ì²˜ë¦¬
                var mediaHtml = "";
                if (data.yt_thumb) {
                    mediaHtml += `<div class="youtube-preview"><a href="${data.yt_link}" target="_blank"><img src="${data.yt_thumb}"></a></div>`;
                }
                if (data.link_data) {
                    mediaHtml += `
                        <a href="${data.link_data.url}" target="_blank" class="link-card">
                            <img src="${data.link_data.image}">
                            <div class="link-info">
                                <div class="link-title">${data.link_data.title}</div>
                            </div>
                        </a>`;
                }
        
                html = `
                    <div class="msg-box ${boxClass}">
                    <span class="nickname">${displayName}</span>
                    <div class="content-wrapper">
                    <div class="message">${msgContent}${mediaHtml}</div>
                </div>
            </div>`;
        }

        chatBox.innerHTML += html;
        chatBox.scrollTop = chatBox.scrollHeight; // ë§¨ ì•„ë˜ë¡œ ìŠ¤í¬ë¡¤
    });

    socket.on('update_users', function(data) {
        document.getElementById('userStatus').innerText = "í˜„ì¬ ì ‘ì†: " + data.count + "ëª… (" + data.users.join(", ") + ")";
    });
    // ì—°ê²°ì´ ëŠê²¼ì„ ë•Œ (ì„œë²„ ì ê²€ì´ë‚˜ ì¸í„°ë„· ë¬¸ì œ ë“±)
    socket.on('disconnect', function() {
        var chatBox = document.getElementById('chatBox');
        if (chatBox) {
            chatBox.innerHTML += "<div class='system' style='color:red; font-weight:bold;'>ğŸš« ì„œë²„ì™€ì˜ ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.</div>";
            chatBox.scrollTop = chatBox.scrollHeight;
        }
        // ì…ë ¥ì°½ê³¼ ë²„íŠ¼ì„ ë¹„í™œì„±í™”í•´ì„œ í˜¼ë€ ë°©ì§€
        document.getElementById('chatInput').disabled = true;
        document.getElementById('nickname').disabled = true;
        document.getElementById('name').disabled = true;
        document.querySelector('button').disabled = true;
    });

    // ì„œë²„ì™€ ë‹¤ì‹œ ì—°ê²°ë˜ì—ˆì„ ë•Œ (ì„ íƒ ì‚¬í•­)
    socket.on('connect', function() {
        console.log("ì„œë²„ì— ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.");
        document.getElementById('chatInput').disabled = false;
        document.getElementById('nickname').disabled = false;
        document.getElementById('name').disabled = false;
        document.querySelector('button').disabled = false;
    });
        
    </script>
</body>
</html>


