<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ’¬ ì±„íŒ…ë°©</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        body { padding: 20px; font-family: sans-serif; background: #f0f2f5; }
        #chatBox { height: 500px; background: white; border-radius: 15px; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; border: 1px solid #ddd; }
        .input-container { display: flex; gap: 10px; margin-top: 20px; }
        #nickname, #name { width: 15%; padding: 10px; border-radius: 8px; border: 1px solid #ddd; }
        #chatInput { flex-grow: 1; padding: 10px; border-radius: 8px; border: 1px solid #ddd; }
        button { padding: 10px 20px; background: #2196f3; color: white; border: none; border-radius: 8px; cursor: pointer; }
        .msg-box { display: flex; flex-direction: column; max-width: 80%; }
        .normal { align-self: flex-start; }
        .admin { align-self: flex-end; align-items: flex-end; }
        .message { padding: 10px; border-radius: 10px; background: #e9efff; }
        .admin .message { background: #e3f2fd; border: 2px solid #2196f3; }
        .nickname { font-size: 12px; font-weight: bold; margin-bottom: 4px; }
        .system { text-align: center; color: #888; font-size: 12px; }
        .link-card { display: flex; border: 1px solid #ddd; border-radius: 8px; overflow: hidden; margin-top: 5px; background: white; text-decoration: none; color: black; }
        .link-card img { width: 80px; height: 80px; object-fit: cover; }
        .link-info { padding: 10px; font-size: 12px; }
    </style>
</head>
<body>
    <div id="userStatus">ì ‘ì† ì¤‘...</div>
    <div id="chatBox"></div>
    <div class="input-container">
        <input type="text" id="nickname" placeholder="ë‹‰ë„¤ì„">
        <input type="text" id="name" placeholder="ì‹¤ëª…">
        <input type="text" id="chatInput" placeholder="ë©”ì‹œì§€ ì…ë ¥" onkeypress="if(event.keyCode==13)sendMyMessage()">
        <button onclick="sendMyMessage()">ì „ì†¡</button>
    </div>

    <script>
        var socket = io();

        function sendMyMessage() {
            var nick = document.getElementById('nickname').value;
            var real = document.getElementById('name').value;
            var msg = document.getElementById('chatInput').value;
            if(!nick || !real || !msg) return alert("ë¹ˆì¹¸ì„ ì±„ì›Œì£¼ì„¸ìš”!");
            
            socket.emit('my_chat', { name: nick, ylm: real, msg: msg });
            document.getElementById('chatInput').value = "";
        }

        socket.on('my_chat', function(data) {
            var chatBox = document.getElementById('chatBox');
            var displayName = data.name;
            
            // ê´€ë¦¬ì ì „ìš© ì‹¤ëª… í‘œì‹œ (ë°ì´í„°ê°€ ìˆì„ ë•Œë§Œ)
            if (data.real_name_secret) {
                displayName += ` <span style="color:red; font-size:10px;">(${data.real_name_secret})</span>`;
            }

            var html = "";
            if(data.role === 'system') {
                html = `<div class="system"><span>${data.msg}</span></div>`;
            } else {
                var boxClass = (data.role === 'admin') ? 'admin' : 'normal';
                var mediaHtml = "";
                if(data.yt_thumb) mediaHtml += `<br><a href="${data.yt_link}" target="_blank"><img src="${data.yt_thumb}" width="200"></a>`;
                if(data.link_data) mediaHtml += `<a href="${data.link_data.url}" class="link-card"><img src="${data.link_data.image}"><div class="link-info"><b>${data.link_data.title}</b></div></a>`;
                
                html = `<div class="msg-box ${boxClass}">
                            <span class="nickname">${displayName}</span>
                            <div class="message">${data.msg}${mediaHtml}</div>
                        </div>`;
            }
            chatBox.innerHTML += html;
            chatBox.scrollTop = chatBox.scrollHeight;
        });

        socket.on('update_users', function(data) {
            document.getElementById('userStatus').innerText = "í˜„ì¬ ì ‘ì†: " + data.count + "ëª… (" + data.users.join(", ") + ")";
        });
    </script>
</body>
</html>

