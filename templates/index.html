<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì±„íŒ…ë°© 4-1</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        body { padding: 20px; font-family: sans-serif; }
        #chatBox { height: 400px; border: 1px solid #ccc; overflow-y: scroll; padding: 10px; margin-bottom: 10px; }
        input { width: 70%; padding: 10px; }
        button { width: 20%; padding: 10px; }
    </style>
</head>
<body>
    <h1>4-1 ì±„íŒ…ë°©</h1>
    <div id="chatBox"></div>
    
    <input type="text" id="chatInput" placeholder="ì¸ì‚¬ë§ì„ ê±´ë„¤ë³´ì„¸ìš”...">
    <button onclick="sendMyMessage()">ì „ì†¡</button>

    <script>
        // ğŸ‘‡ transprot ì˜µì…˜ ê°•ì œ ì§€ì • (ì—°ê²° ì•ˆì •ì„± UP)
        var socket = io({transports: ['websocket', 'polling']});

        // 1. ì—°ê²° í™•ì¸
        socket.on('connect', function() {
            console.log("âœ… ì ‘ì† ì„±ê³µ!");
        });

        // 2. ë©”ì‹œì§€ ë³´ë‚´ê¸° í•¨ìˆ˜ (ì´ë¦„ ë°”ê¿ˆ: sendMyMessage)
        function sendMyMessage() {
            var input = document.getElementById('chatInput');
            var msg = input.value;

            // ğŸ‘‡ ë²„íŠ¼ ëˆ„ë¥´ë©´ ì´ê²Œ ë¬´ì¡°ê±´ ì½˜ì†”ì— ì°í˜€ì•¼ í•¨!
            console.log("ë²„íŠ¼ í´ë¦­ë¨! ë³´ë‚¼ ë‚´ìš©: " + msg); 

            if(msg.trim() !== "") {
                // [ë³€ê²½] send ëŒ€ì‹  emit ì‚¬ìš©! ('my_chat' ì±„ë„ë¡œ ì¨)
                socket.emit('my_chat', msg); 
                input.value = "";
            } else {
                console.log("ë¹ˆ ì¹¸ì´ë¼ ì „ì†¡ ì•ˆ í•¨");
            }
        }

        // 3. ì„œë²„ë¡œë¶€í„° ë©”ì‹œì§€ ë°›ê¸° ('my_chat' ì±„ë„ ê°ì‹œ)
        socket.on('my_chat', function(msg) {
            console.log("ğŸ“© ì„œë²„ì—ì„œ ë‹µì¥ ì˜´: " + msg);
            var chatBox = document.getElementById('chatBox');
            chatBox.innerHTML += "<p>" + msg + "</p>";
            chatBox.scrollTop = chatBox.scrollHeight;
        });

        // ì—”í„°í‚¤ ì²˜ë¦¬
        document.getElementById("chatInput").addEventListener("keyup", function(event) {
            if (event.key === "Enter") {
                sendMyMessage();
            }
        });
    </script>
</body>
</html>
